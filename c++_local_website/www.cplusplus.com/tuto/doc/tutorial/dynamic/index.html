<!DOCTYPE html>
<html>

<!-- Mirrored from www.cplusplus.com/doc/tutorial/dynamic/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 22 Jul 2021 12:46:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Dynamic memory - C++ Tutorials</title>
<link rel="canonical" href="index.html">
<link rel="shortcut icon" type="image/x-icon" href="https://www.cplusplus.com/favicon.ico">
<link rel="stylesheet" type="text/css" href="https://www.cplusplus.com/v322/main.css">
<script src="https://www.cplusplus.com/v322/main.js" type="text/javascript"></script>
<script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
<script>
  window.googletag = window.googletag || {cmd: []};
  googletag.cmd.push(function() {
    googletag.defineSlot('/147246189/cplusplus.com_728x90_leaderboard_1', [728, 90], 'div-gpt-ad-1593433023017-0').addService(googletag.pubads());
    googletag.defineSlot('/147246189/cplusplus.com_234x120_sidebar_1', [234, 60], 'cplusplus.com_234x120_sidebar_1').addService(googletag.pubads());
    googletag.pubads().enableSingleRequest();
    googletag.pubads().disableInitialLoad();
    googletag.enableServices();
  });
</script>
<script src="https://cloud.setupad.com/hb/cpluspluscom.js" async></script>
<script src="https://c.aaxads.com/aax.js?pub=AAX5H4CNQ&amp;hst=www.cplusplus.com&amp;ver=1.2" async></script></head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="https://www.cplusplus.com/" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="https://www.cplusplus.com/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="https://www.cplusplus.com/doc/">Tutorials</a></li>
<li><a href="../index.html">C++ Language</a></li>
<li class="here">Dynamic memory</li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support">
<div id='div-gpt-ad-1593433023017-0' style='width: 728px; height: 90px;'>
  <script>
    googletag.cmd.push(function() { googletag.display('div-gpt-ad-1593433023017-0'); });
  </script>
</div>
</div><div id="I_content">
<div class="C_doc">
<h1>Dynamic memory</h1>
<section id="intro">
In the programs seen in previous chapters, all memory needs were determined before program execution by defining the variables needed. But there may be cases where the memory needs of a program can only be determined during runtime. For example, when the memory needed depends on user input. On these cases, programs need to dynamically allocate memory, for which the C++ language integrates the operators <code>new</code> and <code>delete</code>.<br>
</section>
<br>
<section id="new">
<h3>Operators new and new[]</h3>
Dynamic memory is allocated using operator <code>new</code>. <code>new</code> is followed by a data type specifier and, if a sequence of more than one element is required, the number of these within brackets <code>[]</code>. It returns a pointer to the beginning of the new block of memory allocated. Its syntax is: <br>
<br>
<code>
pointer = new type<br>
pointer = new type [number_of_elements]<br>
</code>
<br>
The first expression is used to allocate memory to contain one single element of type <code>type</code>. The second one is used to allocate a block (an array) of elements of type <code>type</code>, where <code>number_of_elements</code> is an integer value representing the amount of these. For example:<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br></code></pre></td>
<td class="source"><pre><code><var>int</var> * foo;
foo = <var>new</var> <var>int</var> [5];</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
In this case, the system dynamically allocates space for five elements of type <code>int</code> and returns a pointer to the first element of the sequence, which is assigned to <code>foo</code> (a pointer). Therefore, <code>foo</code> now points to a valid block of memory with space for five elements of type <code>int</code>.<br>
<br>
<img src="dynamic.png" alt="">  <br>
<br>
Here, <code>foo</code> is a pointer, and thus, the first element pointed to by <code>foo</code> can be accessed either with the expression <code>foo[0]</code> or the expression <code>*foo</code> (both are equivalent). The second element can be accessed either with <code>foo[1]</code> or <code>*(foo+1)</code>, and so on...<br>
<br>
There is a substantial difference between declaring a normal array and allocating dynamic memory for a block of memory using <code>new</code>. The most important difference is that the size of a regular array needs to be a <i>constant expression</i>, and thus its size has to be determined at the moment of designing the program, before it is run, whereas the dynamic memory allocation performed by <code>new</code> allows to assign memory during runtime using any variable value as size.<br>
<br>
The dynamic memory requested by our program is allocated by the system from the memory heap. However, computer memory is a limited resource, and it can be exhausted. Therefore, there are no guarantees that all requests to allocate memory using operator <code>new</code> are going to be granted by the system. <br>
<br>
C++ provides two standard mechanisms to check if the allocation was successful:<br>
<br>
One is by handling exceptions. Using this method, an exception of type <code>bad_alloc</code> is thrown when the allocation fails. Exceptions are a powerful C++ feature explained later in these tutorials. But for now, you should know that if this exception is thrown and it is not handled by a specific handler, the program execution is terminated.<br>
<br>
This exception method is the method used by default by <code>new</code>, and is the one used in a declaration like:<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>&nbsp;</code></pre></td>
<td class="source"><pre><code>foo = <var>new</var> <var>int</var> [5];  <cite>// if allocation fails, an exception is thrown  </cite></code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
The other method is known as <code>nothrow</code>, and what happens when it is used is that when a memory allocation fails, instead of throwing a <code>bad_alloc</code> exception or terminating the program, the pointer returned by <code>new</code> is a <i>null pointer</i>, and the program continues its execution normally.<br>
<br>
This method can be specified by using a special object called <code>nothrow</code>, declared in header <code><a href="https://www.cplusplus.com/<new>">&lt;new&gt;</a></code>, as argument for <code>new</code>:<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>&nbsp;</code></pre></td>
<td class="source"><pre><code>foo = <var>new</var> (nothrow) <var>int</var> [5]; </code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
In this case, if the allocation of this block of memory fails, the failure can be detected by checking if <code>foo</code> is a null pointer:<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br></code></pre></td>
<td class="source"><pre><code><var>int</var> * foo;
foo = <var>new</var> (nothrow) <var>int</var> [5];
<var>if</var> (foo == <var>nullptr</var>) {
  <cite>// error assigning memory. Take measures.</cite>
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
This <code>nothrow</code> method is likely to produce less efficient code than exceptions, since it implies explicitly checking the pointer value returned after each and every allocation. Therefore, the exception mechanism is generally preferred, at least for critical allocations. Still, most of the coming examples will use the <code>nothrow</code> mechanism due to its simplicity.<br>
</section>
<br>
<section id="delete">
<h3>Operators delete and delete[]</h3>
In most cases, memory allocated dynamically is only needed during specific periods of time within a program; once it is no longer needed, it can be freed so that the memory becomes available again for other requests of dynamic memory. This is the purpose of operator <code>delete</code>, whose syntax is:<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br></code></pre></td>
<td class="source"><pre><code><var>delete</var> pointer;
<var>delete</var>[] pointer;</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
The first statement releases the memory of a single element allocated using <code>new</code>, and the second one releases the memory allocated for arrays of elements using new and a size in brackets (<code>[]</code>).<br>
<br>
The value passed as argument to <code>delete</code> shall be either a pointer to a memory block previously allocated with <code>new</code>, or a <i>null pointer</i> (in the case of a <i>null pointer</i>, <code>delete</code> produces no effect).<br>
<br>
<div class="auto"><table class="split"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br></code></pre></td>
<td class="source"><pre><code><cite>// rememb-o-matic</cite>
<dfn>#include &lt;iostream&gt;</dfn>
<dfn>#include &lt;new&gt;</dfn>
<var>using</var> <var>namespace</var> std;

<var>int</var> main ()
{
  <var>int</var> i,n;
  <var>int</var> * p;
  cout &lt;&lt; <kbd>"How many numbers would you like to type? "</kbd>;
  cin &gt;&gt; i;
  p= <var>new</var> (nothrow) <var>int</var>[i];
  <var>if</var> (p == <var>nullptr</var>)
    cout &lt;&lt; <kbd>"Error: memory could not be allocated"</kbd>;
  <var>else</var>
  {
    <var>for</var> (n=0; n&lt;i; n++)
    {
      cout &lt;&lt; <kbd>"Enter number: "</kbd>;
      cin &gt;&gt; p[n];
    }
    cout &lt;&lt; <kbd>"You have entered: "</kbd>;
    <var>for</var> (n=0; n&lt;i; n++)
      cout &lt;&lt; p[n] &lt;&lt; <kbd>", "</kbd>;
    <var>delete</var>[] p;
  }
  <var>return</var> 0;
}</code></pre></td>
<td class="output"><pre><samp>How many numbers would you like to type? 5
Enter number : 75
Enter number : 436
Enter number : 1067
Enter number : 8
Enter number : 32
You have entered: 75, 436, 1067, 8, 32,</samp></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
Notice how the value within brackets in the new statement is a variable value entered by the user (<code>i</code>), not a constant expression:<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>&nbsp;</code></pre></td>
<td class="source"><pre><code>p= <var>new</var> (nothrow) <var>int</var>[i];</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
There always exists the possibility that the user introduces a value for <code>i</code> so big that the system cannot allocate enough memory for it. For example, when I tried to give a value of 1 billion to the "How many numbers" question, my system could not allocate that much memory for the program, and I got the text message we prepared for this case (<code>Error: memory could not be allocated</code>).<br>
 <br>
It is considered good practice for programs to always be able to handle failures to allocate memory, either by checking the pointer value (if <code>nothrow</code>) or by catching the proper exception.<br>
</section>
<br>
<section id="malloc">
<h3>Dynamic memory in C</h3>
C++ integrates the operators <code>new</code> and <code>delete</code> for allocating dynamic memory. But these were not available in the C language; instead, it used a library solution, with the functions <code><a href="https://www.cplusplus.com/malloc">malloc</a></code>, <code><a href="https://www.cplusplus.com/calloc">calloc</a></code>, <code><a href="https://www.cplusplus.com/realloc">realloc</a></code> and <code><a href="https://www.cplusplus.com/free">free</a></code>, defined in the header <code><a href="https://www.cplusplus.com/<cstdlib>">&lt;cstdlib&gt;</a></code> (known as <code>&lt;stdlib.h&gt;</code> in C). The functions are also available in C++ and can also be used to allocate and deallocate dynamic memory.<br>
<br>
Note, though, that the memory blocks allocated by these functions are not necessarily compatible with those returned by <code>new</code>, so they should not be mixed; each one should be handled with its own set of functions or operators.<br>
</section>â€ƒ<br>
<table class="C_docPrevNext"><tr><td class="prev"><a href="../pointers/index.html" rel="prev"><img src="https://www.cplusplus.com/ico/32arrowleft.png" width="32" height="32" alt="Previous">Previous:<br><b>Pointers</b></a></td><td class="index"><a href="../index.html" rel="index"><img src="https://www.cplusplus.com/ico/32doc.png" width="32" height="32" alt="Index"><br>Index</a></td><td class="next"><a href="../structures/index.html" rel="next"><img src="https://www.cplusplus.com/ico/32arrowright.png" width="32" height="32" alt="Next">Next:<br><b>Data structures</b></a></td></tr></table></div><div id="CH_bb"></div></div>
<div class="C_support">
<div id='div-gpt-ad-1593433023017-0' style='width: 728px; height: 90px;'>
  <script>
    googletag.cmd.push(function() { googletag.display('div-gpt-ad-1593433023017-0'); });
  </script>
</div>
</div></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="https://www.cplusplus.com/">C++</a></b></h3>
<ul>
<li class="folder info"><a href="https://www.cplusplus.com/info/">Information</a></li>
<li class="folder selected doc"><a href="https://www.cplusplus.com/doc/">Tutorials</a></li>
<li class="folder reference"><a href="https://www.cplusplus.com/reference/">Reference</a></li>
<li class="folder articles"><a href="https://www.cplusplus.com/articles/">Articles</a></li>
<li class="folder forum"><a href="https://www.cplusplus.com/forum/">Forum</a></li>
</ul>
</div>
<div class="C_BoxLabels C_BoxSort sect" id="doc_box">
<h3><b><a href="https://www.cplusplus.com/doc/">Tutorials</a></b></h3>
<ul>
<li class="cpp98 cpp11 selected folder"><a href="../index.html"><span>C++ Language</span></a></li>
<li><a href="https://www.cplusplus.com/doc/ascii/"><span>Ascii Codes</span></a></li>
<li><a href="https://www.cplusplus.com/doc/boolean/"><span>Boolean Operations</span></a></li>
<li><a href="https://www.cplusplus.com/doc/hex/"><span>Numerical Bases</span></a></li>
</ul>
</div>
<div class="C_BoxLabels C_BoxSort sect cpp98 cpp11" id="tutorial_box">
<h3><b><a href="../index.html">C++ Language</a></b></h3>
<ul>
<li class="C_Collapsable"><h4>Introduction:</h4><ul>
<li class="folder"><a href="../introduction/index.html"><span>Compilers</span></a></li>
</ul></li>
<li class="C_Collapsable"><h4>Basics of C++:</h4><ul>
<li><a href="../program_structure/index.html"><span>Structure of a program</span></a></li>
<li><a href="../variables/index.html"><span>Variables and types</span></a></li>
<li><a href="../constants/index.html"><span>Constants</span></a></li>
<li><a href="../operators/index.html"><span>Operators</span></a></li>
<li><a href="../basic_io/index.html"><span>Basic Input/Output</span></a></li>
</ul></li>
<li class="C_Collapsable"><h4>Program structure:</h4><ul>
<li><a href="../control/index.html"><span>Statements and flow control</span></a></li>
<li><a href="../functions/index.html"><span>Functions</span></a></li>
<li><a href="../functions2/index.html"><span>Overloads and templates</span></a></li>
<li><a href="../namespaces/index.html"><span>Name visibility</span></a></li>
</ul></li>
<li class="C_Collapsable"><h4>Compound data types:</h4><ul>
<li><a href="../arrays/index.html"><span>Arrays</span></a></li>
<li><a href="../ntcs/index.html"><span>Character sequences</span></a></li>
<li><a href="../pointers/index.html"><span>Pointers</span></a></li>
<li class="selected"><a href="index.html"><span>Dynamic memory</span></a></li>
<li><a href="../structures/index.html"><span>Data structures</span></a></li>
<li><a href="../other_data_types/index.html"><span>Other data types</span></a></li>
</ul></li>
<li class="C_Collapsable"><h4>Classes:</h4><ul>
<li><a href="../classes/index.html"><span>Classes (I)</span></a></li>
<li><a href="../templates/index.html"><span>Classes (II)</span></a></li>
<li><a href="../classes2/index.html"><span>Special members</span></a></li>
<li><a href="../inheritance/index.html"><span>Friendship and inheritance</span></a></li>
<li><a href="../polymorphism/index.html"><span>Polymorphism</span></a></li>
</ul></li>
<li class="C_Collapsable"><h4>Other language features:</h4><ul>
<li><a href="../typecasting/index.html"><span>Type conversions</span></a></li>
<li><a href="../exceptions/index.html"><span>Exceptions</span></a></li>
<li><a href="../preprocessor/index.html"><span>Preprocessor directives</span></a></li>
</ul></li>
<li class="C_Collapsable"><h4>Standard library:</h4><ul>
<li><a href="../files/index.html"><span>Input/output with files</span></a></li>
</ul></li>
</ul>
</div>
<div id="I_subnav"></div>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<p>
<ins class="adsbygoogle"
     style="display:inline-block;width:234px;height:60px"
     data-ad-client="ca-pub-1444228343479937"
     data-ad-slot="3817422056"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="https://www.cplusplus.com/">Home page</a> | <a href="https://www.cplusplus.com/privacy.do">Privacy policy</a><br>&copy; cplusplus.com, 2000-2021 - All rights reserved - <i>v3.2</i><br><a href="https://www.cplusplus.com/contact.do?referrer=www.cplusplus.com%2Fdoc%2Ftutorial%2Fdynamic%2F">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
 onSession ( function(us) {
		el=document.getElementById('CH_bb'); el.innerHTML='';
		if (us.auth(4096)) {
			
			el.appendChild(btn('Edit Page','Edit Page','edit','https://www.cplusplus.com/doc/edit.cgi?a=tutorial+dynamic'));
			el.appendChild(btn('Delete Page','Delete Page','delete','javascript:docdel()'));
		}
	});
	function docdel() { if (confirm('WARNING: You are about to delete this page. Confirm?')) window.location='https://www.cplusplus.com/doc/delete.cgi?a=tutorial+dynamic'; }
	ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

<script>
(function(){
  // mini cookie-consent code (c) Juan Soulie, 2016
  var s ='consent=cookie';
  var e = document.createElement('div');
  e.innerHTML = '<div style="background:#eed;padding:10px;margin:0;text-align:center;border-bottom:1px solid #446"><span style="color:#210;font-weight:bold">This website uses cookies. By continuing, you give permission to deploy cookies, as detailed in our <a href="/privacy.do">privacy policy</a>.</span> <span style="margin-left:10px;border-radius:5px;padding:1px 10px;background:#bcd;border:1px solid #789;cursor:pointer">ok</span></div>';
  if (document.cookie.indexOf(s)!==-1) return;
  var b = document.getElementsByTagName('body')[0];
  b.insertBefore(e,b.firstChild);
  var x = function() { document.cookie = s+'; path=/'; e.parentNode.removeChild(e); };
  e.addEventListener('click',x);
  document.addEventListener('scroll',x);
})();
</script>

</body>

<!-- Mirrored from www.cplusplus.com/doc/tutorial/dynamic/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 22 Jul 2021 12:46:51 GMT -->
</html>